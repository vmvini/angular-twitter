var exports=exports||this;exports.OAuth=function(a){function b(){}function c(a,b){var c=arguments,d=c.callee,g=(c.length,this);return this instanceof d?(a instanceof Array&&2===a.length?(g.name=a[0]+"",g.value=a[1]+""):void 0!==a&&(g.name=a,g.value=void 0===b?"":b),g):new d(a,b)}function d(a){d.superclass.constructor.call(this,a);var f,b=arguments,e=b.callee,g=this;if(!(this instanceof e))return new e(a);if(a instanceof d)a.forEach(function(a){g.push(a)});else if(a instanceof Array)for(f=0;f<a.length;f++)a[f]instanceof Array&&2===a[f].length&&g.push(new c(a[f][0],a[f][1]));return g}function e(a){var d,e,g,h,i,j,k,b=arguments,c=b.callee,l=/^([^:\/?#]+?:\/\/)*([^\/:?#]*)?(:[^\/?#]*)*([^?#]*)(\?[^#]*)?(#(.*))*/,m=this;return this instanceof c?(m.scheme="",m.host="",m.port="",m.path="",m.query=new f,m.anchor="",null!==a&&(d=a.match(l),e=d[1],g=d[2],h=d[3],i=d[4],j=d[5],k=d[6],e=void 0!==e?e.replace("://","").toLowerCase():"http",h=h?h.replace(":",""):"https"===e?"443":"80",e="http"==e&&"443"===h?"https":e,j=j?j.replace("?",""):"",k=k?k.replace("#",""):"",("https"===e&&"443"!==h||"http"===e&&"80"!==h)&&(g=g+":"+h),m.scheme=e,m.host=g,m.port=h,m.path=i||"/",m.query.setQueryParams(j),m.anchor=k||""),void 0):new c(a)}function f(a){f.superclass.constructor.call(this,a)}function h(a){return this instanceof h?this.init(a):new h(a)}function i(a){var f,b=new d,g=h.urlEncode,i=[];return a.forEach(function(a){""!==a.value&&("realm"===a.name.toLowerCase()?f=g(a.name)+'="'+g(a.value)+'"':b.push(new c(a.name,a.value)))}),b.sort().forEach(function(a){i.push(g(a.name)+'="'+g(a.value)+'"')}),f&&i.unshift(f),i.join(", ")}function j(a,b,c,e){var f=new d,i=h.urlEncode,j=new d;return f=f.concat(c).concat(e),f.removeByName("oauth_signature"),f.sort().forEach(function(a){""!==a.value&&j.push(a)}),[a,i(b),i(j.join("&"))].join("&")}function k(){return parseInt(+new Date/1e3,10)}function l(a){function b(){return Math.floor(Math.random()*h.length)}a=a||64;var g,c=a/8,d="",e=c/4,f=c%4,h=["20","21","22","23","24","25","26","27","28","29","2A","2B","2C","2D","2E","2F","30","31","32","33","34","35","36","37","38","39","3A","3B","3C","3D","3E","3F","40","41","42","43","44","45","46","47","48","49","4A","4B","4C","4D","4E","4F","50","51","52","53","54","55","56","57","58","59","5A","5B","5C","5D","5E","5F","60","61","62","63","64","65","66","67","68","69","6A","6B","6C","6D","6E","6F","70","71","72","73","74","75","76","77","78","79","7A","7B","7C","7D","7E"];for(g=0;e>g;g++)d+=h[b()]+h[b()]+h[b()]+h[b()];for(g=0;f>g;g++)d+=h[b()];return d}function m(){var b;if("undefined"!=typeof a.Titanium&&"undefined"!=typeof a.Titanium.Network.createHTTPClient)b=a.Titanium.Network.createHTTPClient();else if("undefined"!=typeof require)try{b=new require("xhr").XMLHttpRequest()}catch(c){if("undefined"==typeof a.XMLHttpRequest)throw"No valid request transport found.";b=new a.XMLHttpRequest}else{if("undefined"==typeof a.XMLHttpRequest)throw"No valid request transport found.";b=new a.XMLHttpRequest}return b}function n(a){var b=new Array(++a);return b.join(0).split("")}function o(a){var c,d,b=[];for(d=0;d<a.length;d++)c=a.charCodeAt(d),128>c?b.push(c):2048>c?b.push(192+(c>>6),128+(63&c)):65536>c?b.push(224+(c>>12),128+(63&c>>6),128+(63&c)):2097152>c&&b.push(240+(c>>18),128+(63&c>>12),128+(63&c>>6),128+(63&c));return b}function p(a){var c,b=[];for(c=0;c<32*a.length;c+=8)b.push(255&a[c>>>5]>>>24-c%32);return b}function q(a){var d,b=[],c=a.length;for(d=0;c>d;d++)b.push((a[d]>>>4).toString(16)),b.push((15&a[d]).toString(16));return b.join("")}function r(a){var d,b="",c=a.length;for(d=0;c>d;d++)b+=String.fromCharCode(a[d]);return b}function s(a,b){return a<<b|a>>>32-b}function t(a){if(void 0!==a){var c,d,b=a;return b.constructor===String&&(b=o(b)),c=this instanceof t?this:new t(a),d=c.hash(b),q(d)}return this instanceof t?this:new t}function u(a,b,c,d){var h,i,j,k,e=o(b),f=o(c),g=e.length;for(g>a.blocksize&&(e=a.hash(e),g=e.length),e=e.concat(n(a.blocksize-g)),i=e.slice(0),j=e.slice(0),k=0;k<a.blocksize;k++)i[k]^=92,j[k]^=54;return h=a.hash(i.concat(a.hash(j.concat(f)))),d?q(h):r(h)}b.prototype=[],b.superclass=Array.prototype,b.prototype.constructor=b,b.prototype.copy=function(){var a=new this.constructor;return this.forEach(function(b){"function"==typeof b.copy&&(b=b.copy()),a.push(b)}),a},b.prototype.concat=function(){for(var b,c,d,a=this.copy(),b=0;b<arguments.length;b++)if(arguments[b]instanceof Array)for(c=0,d=arguments[b].length;d>c;c++)a.push(arguments[b][c]);else a.push(arguments[b]);return a},b.prototype.getFirst=function(){var a=null;return this.length>0&&(a=this[0]),a},"function"!=typeof b.prototype.forEach&&(b.prototype.forEach=function(a,b){var c,d;for(c=0,d=this.length;d>c;++c)c in this&&a.call(b,this[c],c,this);return this}),c.prototype.copy=function(){return new c(this.name,this.value)},c.prototype.toString=function(){var a=h.urlEncode;return a(this.name)+"="+a(this.value)},d.prototype=new b,d.superclass=b.prototype,d.prototype.constructor=d,d.prototype.getByNameInsensitive=function(a){var b=new this.constructor;return this.forEach(function(c){c.name.toLowerCase()===a.toLowerCase()&&b.push(c)}),b},d.prototype.getByName=function(a){var b=new this.constructor;return this.forEach(function(c){c.name===a&&b.push(c)}),b},d.prototype.sort=function(a){return"undefined"==typeof a&&(a=function(a,b){return a.name<b.name?-1:a.name>b.name?1:a.value<b.value?-1:a.value>b.value?1:0}),d.superclass.sort.call(this,a)},d.prototype.removeByName=function(a){var b,c=this.length;for(b=0;c>b;b++)this[b].name===a&&(this.splice(b,1),b--,c--);return this},d.prototype.toString=function(){var a=[],b="";return this.sort().forEach(function(b){a.push(b+"")}),a.length>0&&(b=a.join("&")),b},d.prototype.toJSON=function(){var a=[];return this.forEach(function(b){a.push([b.name,b.value])}),a},e.prototype={scheme:"",host:"",port:"",path:"",query:"",anchor:"",toString:function(){var a=this,b=a.query+"";return a.scheme+"://"+a.host+a.path+(""!=b?"?"+b:"")+(""!==a.anchor?"#"+a.anchor:"")}},f.prototype=new d,f.superclass=d.prototype,f.prototype.constructor=f,f.prototype.setQueryParams=function(a){var f,g,i,k,b=arguments,e=b.length,j=this,l=h.urlDecode;if(1===e){if("object"==typeof a)if(a instanceof Array)for(f=0;f<a.length;f++)a[f]instanceof Array&&2===a[f].length&&j.push(new c(a[f][0],a[f][1]));else if(a instanceof d)j=a.copy();else for(f in a)a.hasOwnProperty(f)&&j.push(new c(f,a[f]));else if("string"==typeof a)for(g=a.split("&"),f=0,i=g.length;i>f;f++)k=g[f].split("="),""!==k[0]&&j.push(new c(l(k[0]),l(k[1])))}else for(f=0;e>f;f+=2)j.push(new c(b[f],b[f+1]))};var g="1.0";return h.prototype={realm:"",requestTokenUrl:"",authorizationUrl:"",accessTokenUrl:"",init:function(a){var f="",n={enablePrivilege:a.enablePrivilege||!1,proxy:a.proxy,proxyUrl:a.proxyUrl,callbackUrl:a.callbackUrl||"oob",consumerKey:a.consumerKey,consumerSecret:a.consumerSecret,accessTokenKey:a.accessTokenKey||f,accessTokenSecret:a.accessTokenSecret||f,verifier:f,signatureMethod:a.signatureMethod||"HMAC-SHA1"};return this.realm=a.realm||f,this.requestTokenUrl=a.requestTokenUrl||f,this.authorizationUrl=a.authorizationUrl||f,this.accessTokenUrl=a.accessTokenUrl||f,this.getAccessToken=function(){return[n.accessTokenKey,n.accessTokenSecret]},this.getAccessTokenKey=function(){return n.accessTokenKey},this.getAccessTokenSecret=function(){return n.accessTokenSecret},this.setAccessToken=function(a,b){b&&(a=[a,b]),n.accessTokenKey=a[0],n.accessTokenSecret=a[1]},this.getVerifier=function(){return n.verifier},this.setVerifier=function(a){n.verifier=a},this.setCallbackUrl=function(a){n.callbackUrl=a},this.request=function(a){var f,o,p,q,r,s,t,v,w,x,y,A,D,E,F,z=[],B=new d;f=a.method||"GET",o=e(a.url),p=a.data?new d(a.data):new d,q=a.headers?new d(a.headers):new d,r=a.success||function(){},s=a.failure||function(){},D=function(){var a=!1;return p instanceof b&&p.forEach(function(b){return b.value instanceof File||"undefined"!=typeof b.value.fileName?(a=!0,!0):void 0}),a}(),A=a.appendQueryString?a.appendQueryString:!1,n.enablePrivilege&&netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead UniversalBrowserWrite"),t=m(),t.onreadystatechange=function(){if(4===t.readyState){var g,a=/^(.*?):\s*(.*?)\r?$/gm,b=q,e=new d,f="";if(t.getAllResponseHeaders)for(f=t.getAllResponseHeaders();g=a.exec(f);)e.push(new c(g[1],g[2]));else if(t.getResponseHeaders){f=t.getResponseHeaders();for(var h=0,i=f.length;i>h;++h)e.push(new c(f[h][0],f[h][1]))}var j=!1,k=e.getByNameInsensitive("Content-Type").getFirst();k&&"text/xml"===k.value&&(j=!0);var l={text:t.responseText,xml:j?t.responseXML:"",requestHeaders:b,responseHeaders:e};t.status>=200&&t.status<=226||304==t.status||0===t.status?r(l):t.status>=400&&0!==t.status&&s(l)}},v=new d([["oauth_callback",n.callbackUrl],["oauth_consumer_key",n.consumerKey],["oauth_token",n.accessTokenKey],["oauth_signature_method",n.signatureMethod],["oauth_timestamp",k()],["oauth_nonce",l()],["oauth_verifier",n.verifier],["oauth_version",g]]),w=n.signatureMethod,B=B.concat(o.query),F=q.getByNameInsensitive("Content-Type").getFirst(),F&&"application/x-www-form-urlencoded"!==F.value.toLowerCase()||D||(B=B.concat(p)),E=o.scheme+"://"+o.host+o.path,x=j(f,E,v,B),y=h.signatureMethod[w](n.consumerSecret,n.accessTokenSecret,x),v.push(new c("oauth_signature",y)),this.realm&&v.push(new c("realm",this.realm)),n.proxy?o="function"==typeof n.proxy?e(n.proxy(o.path,o.query)):""!=o.query?e(n.proxy+o.path+"?"+o.query):e(n.proxy+o.path):n.proxyUrl&&(o=e(n.proxyUrl+o.path)),A||"GET"===f?(o.query.setQueryParams(p),z=null):D?D&&(z=new FormData,p.forEach(function(a){z.append(a.name,a.value)})):"string"==typeof p?(z=p,F||q.push(new c("Content-Type","text/plain"))):(z=p.copy().sort().join("&"),F||q.push(new c("Content-Type","application/x-www-form-urlencoded"))),t.open(f,o+"",!0),t.setRequestHeader("Authorization","OAuth "+i(v)),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),q.forEach(function(a){t.setRequestHeader(a.name,a.value)}),t.send(z)},this},get:function(a,b,c){this.request({url:a,success:b,failure:c})},post:function(a,b,c,d){this.request({method:"POST",url:a,data:b,success:c,failure:d})},getJSON:function(a,b,c){this.get(a,function(a){b(JSON.parse(a.text))},c)},postJSON:function(a,b,c,d){this.request({method:"POST",url:a,data:JSON.stringify(b),success:function(a){c(JSON.parse(a.text))},failure:d,headers:[["Content-Type","application/json"]]})},parseTokenRequest:function(a,b){var c;switch(b){case"text/xml":var d=a.xml.getElementsByTagName("token"),e=a.xml.getElementsByTagName("secret");c={oauth_token:h.urlDecode(d[0]),oauth_token_secret:h.urlDecode(e[0])};break;default:var f=0,g=a.text.split("&"),i=g.length;for(c={};i>f;++f){var j=g[f].split("=");c[h.urlDecode(j[0])]=h.urlDecode(j[1])}}return c},fetchRequestToken:function(a,b){var c=this;c.setAccessToken("","");var d=c.authorizationUrl;this.get(this.requestTokenUrl,function(b){var e=c.parseTokenRequest(b,b.responseHeaders["Content-Type"]||void 0);c.setAccessToken([e.oauth_token,e.oauth_token_secret]),a(d+"?"+b.text)},b)},fetchAccessToken:function(a,b){var c=this;this.get(this.accessTokenUrl,function(b){var d=c.parseTokenRequest(b,b.responseHeaders["Content-Type"]||void 0);c.setAccessToken([d.oauth_token,d.oauth_token_secret]),c.setVerifier(""),a(b)},b)}},h.signatureMethod={"HMAC-SHA1":function(b,c,d){var e,f,g=h.urlEncode;return b=g(b),c=g(c||""),e=b+"&"+c,f=u(t.prototype,e,d),a.btoa(f)}},h.urlEncode=function(a){function b(a){var b=a.toString(16).toUpperCase();return b.length<2&&(b=0+b),"%"+b}if(!a)return"";a+="";var e,g,c=/[ \t\r\n!*"'();:@&=+$,\/?%#\[\]<>{}|`^\\\u0080-\uffff]/,d=a.length,f=a.split("");for(e=0;d>e;e++)(g=f[e].match(c))&&(g=g[0].charCodeAt(0),128>g?f[e]=b(g):2048>g?f[e]=b(192+(g>>6))+b(128+(63&g)):65536>g?f[e]=b(224+(g>>12))+b(128+(63&g>>6))+b(128+(63&g)):2097152>g&&(f[e]=b(240+(g>>18))+b(128+(63&g>>12))+b(128+(63&g>>6))+b(128+(63&g))));return f.join("")},h.urlDecode=function(a){return a?a.replace(/%[a-fA-F0-9]{2}/gi,function(a){return String.fromCharCode(parseInt(a.replace("%",""),16))}):""},t.prototype=new t,t.prototype.blocksize=64,t.prototype.hash=function(a){function A(a,b,c,d){switch(a){case 0:return b&c|~b&d;case 1:case 3:return b^c^d;case 2:return b&c|b&d|c&d}return-1}var d,e,f,g,h,i,j,k,l,m,q,r,t,u,v,w,x,y,z,b=[1732584193,4023233417,2562383102,271733878,3285377520],c=[1518500249,1859775393,2400959708,3395469782];for(a.constructor===String&&(a=o(a.encodeUTF8())),f=a.length,g=Math.ceil((f+9)/this.blocksize)*this.blocksize-(f+9),e=Math.floor(f/4294967296),d=Math.floor(f%4294967296),h=[255&8*e>>24,255&8*e>>16,255&8*e>>8,255&8*e,255&8*d>>24,255&8*d>>16,255&8*d>>8,255&8*d],a=a.concat([128],n(g),h),i=Math.ceil(a.length/this.blocksize),j=0;i>j;j++){for(k=a.slice(j*this.blocksize,(j+1)*this.blocksize),l=k.length,m=[],q=0;l>q;q++)m[q>>>2]|=k[q]<<24-8*(q-4*(q>>2));for(r=b[0],t=b[1],u=b[2],v=b[3],w=b[4],x=0;80>x;x++)x>=16&&(m[x]=s(m[x-3]^m[x-8]^m[x-14]^m[x-16],1)),y=Math.floor(x/20),z=s(r,5)+A(y,t,u,v)+w+c[y]+m[x],w=v,v=u,u=s(t,30),t=r,r=z;b[0]+=r,b[1]+=t,b[2]+=u,b[3]+=v,b[4]+=w}return p(b)},h}(exports);var exports=exports||this;!function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.btoa=a.btoa||function(a){for(var e,f,c=0,d=a.length,g="";d>c;c+=3)e=[a.charCodeAt(c),a.charCodeAt(c+1),a.charCodeAt(c+2)],f=[e[0]>>2,(3&e[0])<<4|e[1]>>4,(15&e[1])<<2|e[2]>>6,63&e[2]],isNaN(e[1])&&(f[2]=64),isNaN(e[2])&&(f[3]=64),g+=b.charAt(f[0])+b.charAt(f[1])+b.charAt(f[2])+b.charAt(f[3]);return g}}(exports);