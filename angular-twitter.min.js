!function(window,angular){"use strict";var TwitterCls=function($q,$http,options,storageMethods,debug){var oauth,requestParams,cb,self=this,errorHandler=function(defer,err,msg){debug&&(msg||(msg="ERROR:"),console.log(msg,err)),defer.reject(err)},callbackErrorHandler=function(defer,msg){return function(error){errorHandler(defer,error,msg)}},successHandler=function(defer,data,msg){debug&&(msg||(msg="SUCCESS:"),console.log(msg,data)),defer.resolve(data)};this.connect=function(cb){var defer=$q.defer();return storageMethods.get().then(function(storedAccessData){storedAccessData?(options.accessTokenSecret=storedAccessData.accessTokenSecret,oauth=OAuth(options),oauth.get("https://api.twitter.com/1/account/verify_credentials.json?skip_status=true",function(data){var entry=JSON.parse(data.text);successHandler(defer,entry,"USER DATA RETURN FROM VERIFY CREDENTIALS")},callbackErrorHandler(defer,"ERROR WHEN VERIFY CREDENTIALS"))):(oauth=OAuth(options),oauth.get("https://api.twitter.com/oauth/request_token",function(data){requestParams=data.text,angular.isUndefined(cb)?successHandler(defer,requestParams):(cb.showWebPage("https://api.twitter.com/oauth/authorize?"+requestParams),cb.onLocationChange=function(loc){self.loginSuccess(loc)})},callbackErrorHandler(defer,"CALL TWITTER OPEN ERROR")))}),defer.promise},this.loginSuccess=function(loc){debug&&console.log("TWITTER RETURN RAW DATA",loc);var verifier="",params=loc.substr(loc.indexOf("?")+1);params=params.split("&");for(var i=0;i<params.length;i++){var y=params[i].split("=");"oauth_verifier"===y[0]&&(verifier=y[1])}oauth.get("https://api.twitter.com/oauth/access_token?oauth_verifier="+verifier+"&"+requestParams,function(data){for(var accessParams={},qvars_tmp=data.text.split("&"),i=0;i<qvars_tmp.length;i++){var y=qvars_tmp[i].split("=");accessParams[y[0]]=decodeURIComponent(y[1])}oauth.setAccessToken([accessParams.oauth_token,accessParams.oauth_token_secret]);var accessData={accessTokenKey:accessParams.oauth_token,accessTokenSecret:accessParams.oauth_token_secret};storageMethods.set(accessData).then(function(){oauth.get("https://api.twitter.com/1/account/verify_credentials.json?skip_status=true",function(data){var entry=JSON.parse(data.text);debug&&console.log("TWITTER USER: ",entry),successHandler(defer,entry)},callbackErrorHandler(defer,"2nd CALL VERIFY CREDENTIALS ERROR"))})},callbackErrorHandler(defer))},this.tweet=function(tweetMsg){var defer=$q.defer();return storageMethods.get().then(function(storedAccessData){options.accessTokenKey=storedAccessData.accessTokenKey,options.accessTokenSecret=storedAccessData.accessTokenSecret,oauth=OAuth(options),oauth.get("https://api.twitter.com/1/account/verify_credentials.json?skip_status=true",function(data){JSON.parse(data.text);self.post(defer,tweetMsg)},callbackErrorHandler(defer))}),defer.promise},this.post=function(defer,tweetMsg){var json={status:tweetMsg,trim_user:"true"};oauth.post("https://api.twitter.com/1/statuses/update.json",json,function(data){var entry=JSON.parse(data.text);successHandler(defer,entry)},callbackErrorHandler(defer,"SEND TWEET ERROR"))},this.phonegapConnect=function(){document.addEventListener("deviceready",function(){if(!window.plugins.childBrowser)throw"require childBrowser plugin install before using this module.";angular.isUndefined(cb)&&(cb=window.plugins.childBrowser),self.connect(cb)},!1)}};angular.module("nbTwitter",[]).provider("$nbTwitter",["$q","$http",function($q,$http){var options={consumerKey:"xxxxxxxxxxxxxxx",consumerSecret:"xxxxxxxxxxxxx",callbackUrl:"http://Your-callback-URL/"},debug=!1,storageMethods={get:function(){var defer=$q.defer(),data=window.localStorage.getItem("angular-twitter-store");return defer.resolve(JSON.parse(data)),defer.promise},set:function(data){data=JSON.stringify(data);var defer=$q.defer();return defer.resolve(window.localStorage.setItem("angular-twitter-store",data)),defer.promise}};this.config=function(opt,debugMode,newStorageMethods){if(angular.isUndefined(opt)||angular.equals(opt,{})||angular.equals(opt,null))throw"You must provide a config options [env,consumerKey,consumerSecret,callbackUrl]";angular.forEach(options,function(val,key){if(angular.isUndefined(opt[key])||!angular.isString(opt[key]))throw"You must provide the `"+key+"` and it must be a string!";if(options[key]&&opt[key]===options[key])throw"Your `"+key+"` dont give me a dummy value, mate!"}),options=opt,debugMode&&"boolean"==typeof debugMode&&(debug=debugMode),!angular.isUndefined(newStorageMethods)&&angular.isObject(newStorageMethods)&&(storageMethods=newStorageMethods)},this.$get=function(){return new TwitterCls($q,$http,options,storageMethods,debug)}}])}(window,window.angular);